// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Installation {
  id              Int              @id @unique @default(autoincrement())
  installation_id Int              @unique @default(autoincrement())
  platform        Platform
  organization    Organization?    @relation(fields: [organizationId], references: [id])
  organizationId  Int?
  token           String
  expiration      String
  type            InstallationType @default(individual)
}

model Organization {
  id            Int            @id @unique @default(autoincrement())
  name          String
  Pull          Pull[]
  users         User[]
  roles         UserRole[]
  installations Installation[]
  repositories  Repository[]
}

model Email {
  id       Int     @id @unique @default(autoincrement())
  name     String  @unique
  verified Boolean @default(false)
  primary  Boolean @default(false)
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId   Int
}

model GithubUserAuthorization {
  id     Int    @id @unique @default(autoincrement())
  token  String
  user   User   @relation(fields: [userId], references: [id])
  userId Int    @unique
}

model User {
  id            Int                      @id @unique @default(autoincrement())
  name          String
  emails        Email[]
  roles         UserRole[]
  organizations Organization[]
  github        GithubUserAuthorization?
}

model UserRole {
  id             Int          @id @unique @default(autoincrement())
  userId         Int
  organizationId Int
  role           Role
  user           User         @relation(fields: [userId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id])
}

model Repository {
  id             Int          @id @unique @default(autoincrement())
  name           String
  html_url       String
  description    String       @default("")
  language       String       @default("")
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  platform       Platform
  api_url        String
  platform_id    Int
  clone_url      String
  tracked        Boolean      @default(false)
  created_at     String
  updated_at     String
}

model Pull {
  id             Int          @id @unique @default(autoincrement())
  jobId          Int          @unique
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  platform       Platform
}

enum Role {
  admin
  manager
  viewer
}

enum Platform {
  github
  bitbucket
}

enum InstallationType {
  individual
  organization
}

enum RequestMethod {
  GET
  POST
}
