// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Installation {
  id              Int           @id @unique @default(autoincrement())
  installation_id Int           @unique @default(autoincrement())
  platform        Platform
  organization    Organization? @relation(fields: [organizationId], references: [id])
  organizationId  Int?
  token           String
  expiration      Int
}

model Organization {
  id            Int            @id @unique @default(autoincrement())
  name          String
  users         User[]
  roles         UserRole[]
  installations Installation[]
}

model Email {
  id       Int     @id @unique @default(autoincrement())
  name     String  @unique
  verified Boolean @default(false)
  primary  Boolean @default(false)
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId   Int
}

model GithubUserAuthorization {
  id     Int    @id @unique @default(autoincrement())
  token  String
  user   User   @relation(fields: [userId], references: [id])
  userId Int    @unique
}

model User {
  id            Int                      @id @unique @default(autoincrement())
  name          String
  emails        Email[]
  roles         UserRole[]
  organizations Organization[]
  github        GithubUserAuthorization?
}

model UserRole {
  id             Int          @id @unique @default(autoincrement())
  userId         Int
  organizationId Int
  role           Role
  user           User         @relation(fields: [userId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id])
}

enum Role {
  admin
  manager
  viewer
}

enum Platform {
  github
  bitbucket
}
