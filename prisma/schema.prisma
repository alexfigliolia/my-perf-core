// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Organization {
  id     Int     @id @unique @default(autoincrement())
  name   String
  owners Owner[]
  roles  Role[]
  users  User[]
}

model Owner {
  id             Int          @id @unique @default(autoincrement())
  userId         Int
  user           User         @relation(fields: [userId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int
}

model Email {
  id       Int     @id @unique @default(autoincrement())
  email    String
  user     User    @relation(fields: [userId], references: [id])
  userId   Int
  verified Boolean @default(false)
  primary  Boolean @default(false)
}

model User {
  id            Int            @id @unique @default(autoincrement())
  name          String
  emails        Email[]
  roles         Role[]
  ownerships    Owner[]
  organizations Organization[]
  github        GithubUser?
}

model GithubUser {
  id     Int    @id @unique @default(autoincrement())
  token  String
  user   User   @relation(fields: [userId], references: [id])
  userId Int    @unique
}

model Role {
  id             Int          @id @unique @default(autoincrement())
  type           UserRole     @default(viewer)
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int
  userId         Int
  user           User         @relation(fields: [userId], references: [id])
}

model GithubRepository {
  id        Int    @id @unique @default(autoincrement())
  name      String
  url       String
  clone_url String
  language  String
}

enum UserRole {
  admin
  engineer
  viewer
}

enum Platform {
  github
  bitbucket
}
